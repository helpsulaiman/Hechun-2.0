generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// --- USER MANAGEMENT ---
model UserProfile {
  id                String    @id @default(uuid())
  user_id           String    @unique // Links to Supabase Auth
  username          String?
  email             String?
  avatar_url        String?
  
  // Progress Stats (Simplified)
  is_admin          Boolean   @default(false)
  lessons_completed Int       @default(0)
  total_xp          Int       @default(0) // Replacing stars with generic XP
  streak_days       Int       @default(0)
  last_active_date  DateTime?
  
  // Skill Tracking (Vector)
  skill_vector      Json?     // { "reading": 10, "writing": 15, ... }

  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt

  lessons  LessonProgress[]

  @@map("user_profiles")
}

// --- CONTENT ENGINE ---
// No more "LearningLevels". Lessons are standalone items with complexity.

model Lesson {
  id              Int       @id // manual ID (e.g. 1001, 1002)
  lesson_order    Int       // Global order for the linear path
  title           String
  description     String?
  content         Json      // The structured JSON content
  
  // Metadata for the Engine
  complexity      Float     @default(1.0) // 1.0 = Beginner, 5.0 = Native
  skills_targeted Json?     // { "reading": 0.5, "grammar": 0.5 }
  xp_reward       Int       @default(10)

  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt

  progress        LessonProgress[]

  @@map("lessons")
}

model LessonProgress {
  id          String    @id @default(uuid())
  user_id     String
  lesson_id   Int
  
  score       Float     @default(0.0) // 0.0 to 1.0 (Accuracy)
  completed_at DateTime @default(now())

  user        UserProfile @relation(fields: [user_id], references: [id], onDelete: Cascade)
  lesson      Lesson      @relation(fields: [lesson_id], references: [id], onDelete: Cascade)

  @@unique([user_id, lesson_id])
  @@map("lesson_progress")
}

// --- END OF SCHEMA ---
